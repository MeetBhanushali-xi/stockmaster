<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Dashboard - StockMaster</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    overflow-x: hidden;
  }

  /* Sidebar */
  .sidebar {
    width: 250px;
    height: 100vh;
    position: fixed;
    left: 0;
    top: 0;
    background: #1e1e2f;
    padding-top: 20px;
    color: white;
  }

  .sidebar a {
    color: #d2d2d2;
    padding: 12px 20px;
    display: block;
    text-decoration: none;
    font-size: 15px;
    border-radius: 5px;
    margin: 4px 8px;
  }

  .sidebar a.active,
  .sidebar a:hover {
    background: #34344a;
    color: white;
  }

  .brand {
    font-size: 20px;
    font-weight: bold;
    padding-left: 20px;
    margin-bottom: 20px;
  }

  .content {
    margin-left: 260px;
    padding: 20px;
  }
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
  <div class="brand">StockMaster</div>

  <a href="dashboard.html" id="menu-dashboard">Dashboard</a>
  <a href="products.html" id="menu-products">Products</a>
  <a href="receipts.html" id="menu-receipts">Receipts</a>
  <a href="deliveries.html" id="menu-deliveries">Deliveries</a>
  <a href="transfers.html" id="menu-transfers">Transfers</a>


  <hr style="border-color:#555;">
  <a href="forgot_password.html">Forgot Password</a>
  <a href="login.html">Logout</a>
</div>

<!-- MAIN PAGE CONTENT -->
<div class="content">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h4 class="mb-0">Dashboard</h4>
      <small class="text-muted">Overview of inventory operations</small>
    </div>
    <button id="refreshBtn" class="btn btn-sm btn-primary">Refresh</button>
  </div>

  <!-- KPI cards -->
  <div id="kpiRow" class="row gy-3">

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="card-title">Total Products</h6>
          <h2 id="totalProducts" class="fw-bold">—</h2>
          <small class="text-muted">Products in catalogue</small>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm border-warning">
        <div class="card-body">
          <h6 class="card-title">Low / Out of Stock</h6>
          <h2 id="lowStockItems" class="fw-bold text-warning">—</h2>
          <small class="text-muted">Needs reorder or check</small>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm border-info">
        <div class="card-body">
          <h6 class="card-title">Pending Receipts</h6>
          <h2 id="pendingReceipts" class="fw-bold text-info">—</h2>
          <small class="text-muted">Incoming stock to validate</small>
        </div>
      </div>
    </div>

    <div class="col-sm-6 col-lg-3">
      <div class="card shadow-sm border-danger">
        <div class="card-body">
          <h6 class="card-title">Pending Deliveries</h6>
          <h2 id="pendingDeliveries" class="fw-bold text-danger">—</h2>
          <small class="text-muted">Outgoing orders to process</small>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-4 mt-3">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="card-title">Internal Transfers Scheduled</h6>
          <h2 id="internalTransfersScheduled" class="fw-bold">—</h2>
          <small class="text-muted">Transfers between locations</small>
        </div>
      </div>
    </div>

  </div>

  <div class="mt-4 text-muted">
    <small>Data is read from JSON files in the backend (no DB).</small>
  </div>

</div>

<script>
function activateMenu(id) {
  const el = document.getElementById(id);
  if (el) el.classList.add("active");
}

// Highlight dashboard in menu
activateMenu("menu-dashboard");

// Dashboard API call
const api = "/api/dashboard";

async function loadDashboard() {
  setLoading(true);
  try {
    const res = await fetch(api);
    if (!res.ok) throw new Error("Fetch failed: " + res.status);
    const d = await res.json();

    document.getElementById("totalProducts").innerText = d.totalProducts ?? 0;
    document.getElementById("lowStockItems").innerText = d.lowStockItems ?? 0;
    document.getElementById("pendingReceipts").innerText = d.pendingReceipts ?? 0;
    document.getElementById("pendingDeliveries").innerText = d.pendingDeliveries ?? 0;
    document.getElementById("internalTransfersScheduled").innerText = d.internalTransfersScheduled ?? 0;

  } catch (err) {
    console.error(err);
    alert("Failed to load dashboard: " + err.message);
  } finally {
    setLoading(false);
  }
}

function setLoading(isLoading) {
  const refresh = document.getElementById("refreshBtn");
  refresh.disabled = isLoading;
  refresh.innerText = isLoading ? "Loading..." : "Refresh";
}

document.getElementById("refreshBtn").addEventListener("click", loadDashboard);

// Load dashboard instantly
loadDashboard();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
